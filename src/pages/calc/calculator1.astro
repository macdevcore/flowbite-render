---
import LayoutSidebar from '../../app/LayoutSidebar.astro';
import CalcContent from '../../modules/CalcContent.astro';

import { createClient } from '@supabase/supabase-js';

const calcId = 1;
var userId = '77173b116fde045e661a0cb7ec902919';
const supabaseUrl = 'https://anyfrhmfxqicdhttxkij.supabase.co';
const supabaseAnonKey =
	'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFueWZyaG1meHFpY2RodHR4a2lqIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY4NjYzNDY3NywiZXhwIjoyMDAyMjEwNjc3fQ.xKmXdHqvIow96RjRvzX1ckYTeVZbjeVPfxkEBtE-8sM';
const supabase = createClient(supabaseUrl, supabaseAnonKey, {
	global: { fetch: fetch.bind(globalThis) }
});
const { data, error } = await supabase
.from('Calculator')
.select('prop1, prop2, prop3, prop4, check1, text')
.eq('user_id', userId)
.eq('calc', calcId)
.limit(1).single();
---

<LayoutSidebar>
	<CalcContent id={calcId} prop1={data.prop1} prop2={data.prop2} prop3={data.prop3} prop4={data.prop4} check1={data.check1} text={data.text}/>
</LayoutSidebar>

<script>
	async function saveCalcValues(calc){
		let calcProp1 = document.getElementById("prop-1").value;
		let userId = '77173b116fde045e661a0cb7ec902919';
		const supabaseUrl = 'https://anyfrhmfxqicdhttxkij.supabase.co';
		const supabaseAnonKey =
			'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFueWZyaG1meHFpY2RodHR4a2lqIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY4NjYzNDY3NywiZXhwIjoyMDAyMjEwNjc3fQ.xKmXdHqvIow96RjRvzX1ckYTeVZbjeVPfxkEBtE-8sM';
		const supabase = createClient(supabaseUrl, supabaseAnonKey, {
			global: { fetch: fetch.bind(globalThis) }
		});
		const { error } = await supabase
		.from('Calculator')
		.update({ prop1: calcProp1 })
		.eq('user_id', userId).eq('calc', calc);
	}
</script>
